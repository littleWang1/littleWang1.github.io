<!DOCTYPE html><html lang="zh-CN" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.3" /><meta property="og:title" content="微服务一Nacos" /><meta name="author" content="superWang" /><meta property="og:locale" content="zh_CN" /><meta name="description" content="1.微服务技术栈" /><meta property="og:description" content="1.微服务技术栈" /><link rel="canonical" href="/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%80/" /><meta property="og:url" content="/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%80/" /><meta property="og:site_name" content="小牛" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2024-03-07T02:34:00+00:00" /><meta name="twitter:card" content="summary" /><meta property="twitter:title" content="微服务一Nacos" /><meta name="twitter:site" content="@twitter_username" /><meta name="twitter:creator" content="@superWang" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"superWang"},"dateModified":"2024-03-12T05:12:52+00:00","datePublished":"2024-03-07T02:34:00+00:00","description":"1.微服务技术栈","headline":"微服务一Nacos","mainEntityOfPage":{"@type":"WebPage","@id":"/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%80/"},"url":"/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%80/"}</script><title>微服务一Nacos | 小牛</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="小牛"><meta name="application-name" content="小牛"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script> <script type="text/javascript"> class ModeToggle { static get MODE_KEY() { return "mode"; } static get MODE_ATTR() { return "data-mode"; } static get DARK_MODE() { return "dark"; } static get LIGHT_MODE() { return "light"; } static get ID() { return "mode-toggle"; } constructor() { if (this.hasMode) { if (this.isDarkMode) { if (!this.isSysDarkPrefer) { this.setDark(); } } else { if (this.isSysDarkPrefer) { this.setLight(); } } } let self = this; /* always follow the system prefers */ this.sysDarkPrefers.addEventListener('change', () => { if (self.hasMode) { if (self.isDarkMode) { if (!self.isSysDarkPrefer) { self.setDark(); } } else { if (self.isSysDarkPrefer) { self.setLight(); } } self.clearMode(); } self.notify(); }); } /* constructor() */ get sysDarkPrefers() { return window.matchMedia("(prefers-color-scheme: dark)"); } get isSysDarkPrefer() { return this.sysDarkPrefers.matches; } get isDarkMode() { return this.mode === ModeToggle.DARK_MODE; } get isLightMode() { return this.mode === ModeToggle.LIGHT_MODE; } get hasMode() { return this.mode != null; } get mode() { return sessionStorage.getItem(ModeToggle.MODE_KEY); } /* get the current mode on screen */ get modeStatus() { if (this.isDarkMode || (!this.hasMode && this.isSysDarkPrefer)) { return ModeToggle.DARK_MODE; } else { return ModeToggle.LIGHT_MODE; } } setDark() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.DARK_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.DARK_MODE); } setLight() { $('html').attr(ModeToggle.MODE_ATTR, ModeToggle.LIGHT_MODE); sessionStorage.setItem(ModeToggle.MODE_KEY, ModeToggle.LIGHT_MODE); } clearMode() { $('html').removeAttr(ModeToggle.MODE_ATTR); sessionStorage.removeItem(ModeToggle.MODE_KEY); } /* Notify another plugins that the theme mode has changed */ notify() { window.postMessage({ direction: ModeToggle.ID, message: this.modeStatus }, "*"); } flipMode() { if (this.hasMode) { if (this.isSysDarkPrefer) { if (this.isLightMode) { this.clearMode(); } else { this.setLight(); } } else { if (this.isDarkMode) { this.clearMode(); } else { this.setDark(); } } } else { if (this.isSysDarkPrefer) { this.setLight(); } else { this.setDark(); } } this.notify(); } /* flipMode() */ } /* ModeToggle */ const modeToggle = new ModeToggle(); </script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/config/avatar.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">小牛</a></div><div class="site-subtitle font-italic">这里是小牛的博客～</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>首页</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>分类</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tags ml-xl-3 mr-xl-3 unloaded"></i> <span>标签</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>归档</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>关于</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <button class="mode-toggle btn" aria-label="Switch Mode"> <i class="fas fa-adjust"></i> </button> <span class="icon-border"></span> <a href="https://github.com/littleWang1" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="https://twitter.com/twitter_username" aria-label="twitter" target="_blank" rel="noopener noreferrer"> <i class="fab fa-twitter"></i> </a> <a href="javascript:location.href = 'mailto:' + ['1657498912','qq.com'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> 首页 </a> </span> <span>微服务一Nacos</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> 文章</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="搜索..."> </span> <span id="search-cancel" >取消</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>微服务一Nacos</h1><div class="post-meta text-muted"> <span> 发表于 <em class="" data-ts="1709778840" data-df="YYYY/MM/DD" data-toggle="tooltip" data-placement="bottom"> 2024/03/07 </em> </span> <span> 更新于 <em class="" data-ts="1710220372" data-df="YYYY/MM/DD" data-toggle="tooltip" data-placement="bottom"> 2024/03/12 </em> </span><div class="d-flex justify-content-between"> <span> 作者 <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2671 字"> <em>14 分钟</em>阅读</span></div></div></div><div class="post-content"><h1 id="1微服务技术栈">1.微服务技术栈</h1><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307094350538.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307094350538.png" alt="image-20240307094350538" class="lazyload" data-proofer-ignore></a></p><p>持续集成</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307094415532.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307094415532.png" alt="image-20240307094415532" class="lazyload" data-proofer-ignore></a></p><h1 id="2认识微服务">2.认识微服务</h1><p>单体架构</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307095216244.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307095216244.png" alt="image-20240307095216244" class="lazyload" data-proofer-ignore></a></p><p>分布式架构</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307095459425.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307095459425.png" alt="image-20240307095459425" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307095704232.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307095704232.png" alt="image-20240307095704232" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307100407395.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307100407395.png" alt="image-20240307100407395" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307100906672.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307100906672.png" alt="image-20240307100906672" class="lazyload" data-proofer-ignore></a></p><p>认识微服务</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307110138265.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307110138265.png" alt="image-20240307110138265" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307110310650.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307110310650.png" alt="image-20240307110310650" class="lazyload" data-proofer-ignore></a></p><p>springCloud与SpringBoot的版本兼容关系</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307110503559.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307110503559.png" alt="image-20240307110503559" style="zoom:67%;" class="lazyload" data-proofer-ignore></a></p><h3 id="微服务拆分注意事项"><span class="mr-2">微服务拆分注意事项</span><a href="#微服务拆分注意事项" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307110810366.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307110810366.png" alt="image-20240307110810366" class="lazyload" data-proofer-ignore></a></p><h1 id="3服务远程调用">3.服务远程调用</h1><p>步骤一：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307140038524.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307140038524.png" alt="image-20240307140038524" class="lazyload" data-proofer-ignore></a></p><p>步骤二：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307140051993.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307140051993.png" alt="image-20240307140051993" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307140732927.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307140732927.png" alt="image-20240307140732927" class="lazyload" data-proofer-ignore></a></p><p>消费者与提供者</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307145131554.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307145131554.png" alt="image-20240307145131554" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307145243098.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307145243098.png" alt="image-20240307145243098" class="lazyload" data-proofer-ignore></a></p><h1 id="4eureka注册中心">4.Eureka注册中心</h1><p>服务调用会出现问题比如：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307145612153.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307145612153.png" alt="image-20240307145612153" class="lazyload" data-proofer-ignore></a></p><p>这个时候需要Eureka可以解决这些问题</p><p>Eureka的作用</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307145942350.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307145942350.png" alt="image-20240307145942350" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307150038624.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307150038624.png" alt="image-20240307150038624" class="lazyload" data-proofer-ignore></a></p><p>总结：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307150104288.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307150104288.png" alt="image-20240307150104288" class="lazyload" data-proofer-ignore></a></p><p>如何搭建Eureka</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307150610463.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307150610463.png" alt="image-20240307150610463" class="lazyload" data-proofer-ignore></a></p><p>eurka注册</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre>server:
  port: 10086 # 服务端口
spring:
  application:
    name: eurekaserver # eurka服务名称
eureka:
  client:
    service-url:
      defaultZone: http://localhost:10086/eureka
</pre></table></code></div></div><p>找到eureka的main函数，启动eureka</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307154539820.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307154539820.png" alt="image-20240307154539820" class="lazyload" data-proofer-ignore></a></p><p>服务的实例列表</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307154816920.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307154816920.png" alt="image-20240307154816920" class="lazyload" data-proofer-ignore></a></p><p>服务注册</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307161552202.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307161552202.png" alt="image-20240307161552202" class="lazyload" data-proofer-ignore></a></p><p>模拟多实例注入</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307162202454.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307162202454.png" alt="image-20240307162202454" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307171125847.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307171125847.png" alt="image-20240307171125847" class="lazyload" data-proofer-ignore></a></p><p>服务拉取</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307171459248.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307171459248.png" alt="image-20240307171459248" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307171545240.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307171545240.png" alt="image-20240307171545240" class="lazyload" data-proofer-ignore></a></p><p>Ribbon负载均衡</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307171846016.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307171846016.png" alt="image-20240307171846016" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307174901302.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307174901302.png" alt="image-20240307174901302" class="lazyload" data-proofer-ignore></a></p><h1 id="5ribbon负载均衡">5.Ribbon负载均衡</h1><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307184429669.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307184429669.png" alt="image-20240307184429669" class="lazyload" data-proofer-ignore></a></p><p>负载均衡策略实现有两种方案</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307185334130.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307185334130.png" alt="image-20240307185334130" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307190228425.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307190228425.png" alt="image-20240307190228425" class="lazyload" data-proofer-ignore></a></p><h1 id="6nacos">6.Nacos</h1><h3 id="启动nacos报错-用这个命令解决"><span class="mr-2">启动Nacos报错-&gt;用这个命令解决</span><a href="#启动nacos报错-用这个命令解决" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><h3 id="startupcmd--m-standalone"><span class="mr-2">.\startup.cmd -m standalone</span><a href="#startupcmd--m-standalone" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307192757439.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307192757439.png" alt="image-20240307192757439" class="lazyload" data-proofer-ignore></a></p><p>访问此网站： http://192.168.150.1:8848/nacos/index.html</p><p>网站默认账号和密码都是 nacos</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307193108404.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307193108404.png" alt="image-20240307193108404" class="lazyload" data-proofer-ignore></a></p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre>&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba.cloud&lt;/groupId&gt;
    &lt;artifactId&gt;spring-cloud-alibaba-dependencies&lt;/artifactId&gt;
    &lt;version&gt;2.2.5.RELEASE&lt;/version&gt;
    &lt;type&gt;pom&lt;/type&gt;
    &lt;scope&gt;import&lt;/scope&gt;
&lt;/dependency&gt;
</pre></table></code></div></div><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307194544721.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307194544721.png" alt="image-20240307194544721" class="lazyload" data-proofer-ignore></a></p><p>集群的概念：nacos引用此概念，就是为了防止服务跨集群调用</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307194749913.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307194749913.png" alt="image-20240307194749913" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307195012911.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307195012911.png" alt="image-20240307195012911" class="lazyload" data-proofer-ignore></a> 如何配置一个实例的集群</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307195047012.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307195047012.png" alt="image-20240307195047012" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307201630633.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307201630633.png" alt="image-20240307201630633" class="lazyload" data-proofer-ignore></a></p><p>根据权重配置负载均衡</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307210148308.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307210148308.png" alt="image-20240307210148308" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307210930965.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307210930965.png" alt="image-20240307210930965" class="lazyload" data-proofer-ignore></a></p><h1 id="7环境隔离namespace">7.环境隔离–namespace</h1><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307211510188.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307211510188.png" alt="image-20240307211510188" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307211737174.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307211737174.png" alt="image-20240307211737174" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307211750733.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307211750733.png" alt="image-20240307211750733" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307211802040.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307211802040.png" alt="image-20240307211802040" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307211812747.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307211812747.png" alt="image-20240307211812747" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307212016819.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307212016819.png" alt="image-20240307212016819" class="lazyload" data-proofer-ignore></a></p><h3 id="nacos注册中心细节分析"><span class="mr-2">nacos注册中心细节分析</span><a href="#nacos注册中心细节分析" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307213736200.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307213736200.png" alt="image-20240307213736200" class="lazyload" data-proofer-ignore></a></p><p>临时实例和非临时实例</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307213806742.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307213806742.png" alt="image-20240307213806742" class="lazyload" data-proofer-ignore></a></p><h3 id="nacos和eureka区别"><span class="mr-2">nacos和eureka区别</span><a href="#nacos和eureka区别" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240307213956638.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240307213956638.png" alt="image-20240307213956638" class="lazyload" data-proofer-ignore></a></p><h1 id="8nacos配置管理">8.Nacos配置管理</h1><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308115857145.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308115857145.png" alt="image-20240308115857145" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308120904025.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308120904025.png" alt="image-20240308120904025" class="lazyload" data-proofer-ignore></a></p><p>注：热更新需求，需要修改配置内容中的数据，切记不是把userservice中一切配置都拿过来，只需要把需要用到热更新的配置拿过来</p><p>第一步：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308121155424.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308121155424.png" alt="image-20240308121155424" class="lazyload" data-proofer-ignore></a></p><p>第二部：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308121311999.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308121311999.png" alt="image-20240308121311999" class="lazyload" data-proofer-ignore></a></p><h2 id="同意配置管理"><span class="mr-2">同意配置管理</span><a href="#同意配置管理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308121849386.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308121849386.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>bootstrap.yml的优先级比nacos配置文件中的优先级更高，所以会优先访问bootstrap.yml文件</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308121834500.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308121834500.png" alt="image-20240308121834500" class="lazyload" data-proofer-ignore></a></p><p>name+active+file-extension = Date Id（nacos配置文件中）</p><p>怎么证明读取到了nacos的配置？</p><p>向配置中读取自定义的配置，如果读到了就等于配置成功了</p><p>配置cocas注意：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308144932357.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308144932357.png" alt="" class="lazyload" data-proofer-ignore></a></p><p>自动代码会出现discovery： 删除它就行了</p><h2 id="配置自动刷新"><span class="mr-2">配置自动刷新</span><a href="#配置自动刷新" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="方式一"><span class="mr-2">方式一：</span><a href="#方式一" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308145503068.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308145503068.png" alt="image-20240308145503068" class="lazyload" data-proofer-ignore></a></p><h3 id="方式二"><span class="mr-2">方式二：</span><a href="#方式二" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308150043819.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308150043819.png" alt="image-20240308150043819" class="lazyload" data-proofer-ignore></a></p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308150549627.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308150549627.png" alt="image-20240308150549627" class="lazyload" data-proofer-ignore></a></p><p>多服务共享配置：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308152746382.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308152746382.png" alt="image-20240308152746382" class="lazyload" data-proofer-ignore></a></p><h1 id="9nacos集群搭建">9.Nacos集群搭建</h1><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20240308153926126.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20240308153926126.png" alt="image-20240308153926126" class="lazyload" data-proofer-ignore></a></p><h1 id="1集群结构图">1.集群结构图</h1><p>官方给出的Nacos集群图：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20210409210621117.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20210409210621117.png" alt="image-20210409210621117" class="lazyload" data-proofer-ignore></a></p><p>其中包含3个nacos节点，然后一个负载均衡器代理3个Nacos。这里负载均衡器可以使用nginx。</p><p>我们计划的集群结构：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20210409211355037.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20210409211355037.png" alt="image-20210409211355037" class="lazyload" data-proofer-ignore></a></p><p>三个nacos节点的地址：</p><div class="table-wrapper"><table><thead><tr><th>节点<th>ip<th>port<tbody><tr><td>nacos1<td>192.168.150.1<td>8845<tr><td>nacos2<td>192.168.150.1<td>8846<tr><td>nacos3<td>192.168.150.1<td>8847</table></div><h1 id="2搭建集群">2.搭建集群</h1><p>搭建集群的基本步骤：</p><ul><li>搭建数据库，初始化数据库表结构<li>下载nacos安装包<li>配置nacos<li>启动nacos集群<li>nginx反向代理</ul><h2 id="21初始化数据库"><span class="mr-2">2.1.初始化数据库</span><a href="#21初始化数据库" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Nacos默认数据存储在内嵌数据库Derby中，不属于生产可用的数据库。</p><p>官方推荐的最佳实践是使用带有主从的高可用数据库集群，主从模式的高可用数据库可以参考<strong>传智教育</strong>的后续高手课程。</p><p>这里我们以单点的数据库为例来讲解。</p><p>首先新建一个数据库，命名为nacos，而后导入下面的SQL：</p><div class="language-sql highlighter-rouge"><div class="code-header"> <span data-label-text="Sql"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
</pre><td class="rouge-code"><pre><span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`config_info`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">'id'</span><span class="p">,</span>
  <span class="nv">`data_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'data_id'</span><span class="p">,</span>
  <span class="nv">`group_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`content`</span> <span class="nb">longtext</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'content'</span><span class="p">,</span>
  <span class="nv">`md5`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'md5'</span><span class="p">,</span>
  <span class="nv">`gmt_create`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">'创建时间'</span><span class="p">,</span>
  <span class="nv">`gmt_modified`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">'修改时间'</span><span class="p">,</span>
  <span class="nv">`src_user`</span> <span class="nb">text</span> <span class="k">COMMENT</span> <span class="s1">'source user'</span><span class="p">,</span>
  <span class="nv">`src_ip`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'source ip'</span><span class="p">,</span>
  <span class="nv">`app_name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`tenant_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'租户字段'</span><span class="p">,</span>
  <span class="nv">`c_desc`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`c_use`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`effect`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`type`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`c_schema`</span> <span class="nb">text</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`uk_configinfo_datagrouptenant`</span> <span class="p">(</span><span class="nv">`data_id`</span><span class="p">,</span><span class="nv">`group_id`</span><span class="p">,</span><span class="nv">`tenant_id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">'config_info'</span><span class="p">;</span>

<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = config_info_aggr   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`config_info_aggr`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">'id'</span><span class="p">,</span>
  <span class="nv">`data_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'data_id'</span><span class="p">,</span>
  <span class="nv">`group_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'group_id'</span><span class="p">,</span>
  <span class="nv">`datum_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'datum_id'</span><span class="p">,</span>
  <span class="nv">`content`</span> <span class="nb">longtext</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'内容'</span><span class="p">,</span>
  <span class="nv">`gmt_modified`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'修改时间'</span><span class="p">,</span>
  <span class="nv">`app_name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`tenant_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'租户字段'</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`uk_configinfoaggr_datagrouptenantdatum`</span> <span class="p">(</span><span class="nv">`data_id`</span><span class="p">,</span><span class="nv">`group_id`</span><span class="p">,</span><span class="nv">`tenant_id`</span><span class="p">,</span><span class="nv">`datum_id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">'增加租户字段'</span><span class="p">;</span>


<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = config_info_beta   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`config_info_beta`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">'id'</span><span class="p">,</span>
  <span class="nv">`data_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'data_id'</span><span class="p">,</span>
  <span class="nv">`group_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'group_id'</span><span class="p">,</span>
  <span class="nv">`app_name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'app_name'</span><span class="p">,</span>
  <span class="nv">`content`</span> <span class="nb">longtext</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'content'</span><span class="p">,</span>
  <span class="nv">`beta_ips`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'betaIps'</span><span class="p">,</span>
  <span class="nv">`md5`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'md5'</span><span class="p">,</span>
  <span class="nv">`gmt_create`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">'创建时间'</span><span class="p">,</span>
  <span class="nv">`gmt_modified`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">'修改时间'</span><span class="p">,</span>
  <span class="nv">`src_user`</span> <span class="nb">text</span> <span class="k">COMMENT</span> <span class="s1">'source user'</span><span class="p">,</span>
  <span class="nv">`src_ip`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'source ip'</span><span class="p">,</span>
  <span class="nv">`tenant_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'租户字段'</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`uk_configinfobeta_datagrouptenant`</span> <span class="p">(</span><span class="nv">`data_id`</span><span class="p">,</span><span class="nv">`group_id`</span><span class="p">,</span><span class="nv">`tenant_id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">'config_info_beta'</span><span class="p">;</span>

<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = config_info_tag   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`config_info_tag`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">'id'</span><span class="p">,</span>
  <span class="nv">`data_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'data_id'</span><span class="p">,</span>
  <span class="nv">`group_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'group_id'</span><span class="p">,</span>
  <span class="nv">`tenant_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'tenant_id'</span><span class="p">,</span>
  <span class="nv">`tag_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'tag_id'</span><span class="p">,</span>
  <span class="nv">`app_name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'app_name'</span><span class="p">,</span>
  <span class="nv">`content`</span> <span class="nb">longtext</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'content'</span><span class="p">,</span>
  <span class="nv">`md5`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'md5'</span><span class="p">,</span>
  <span class="nv">`gmt_create`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">'创建时间'</span><span class="p">,</span>
  <span class="nv">`gmt_modified`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">'修改时间'</span><span class="p">,</span>
  <span class="nv">`src_user`</span> <span class="nb">text</span> <span class="k">COMMENT</span> <span class="s1">'source user'</span><span class="p">,</span>
  <span class="nv">`src_ip`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'source ip'</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`uk_configinfotag_datagrouptenanttag`</span> <span class="p">(</span><span class="nv">`data_id`</span><span class="p">,</span><span class="nv">`group_id`</span><span class="p">,</span><span class="nv">`tenant_id`</span><span class="p">,</span><span class="nv">`tag_id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">'config_info_tag'</span><span class="p">;</span>

<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = config_tags_relation   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`config_tags_relation`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'id'</span><span class="p">,</span>
  <span class="nv">`tag_name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'tag_name'</span><span class="p">,</span>
  <span class="nv">`tag_type`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'tag_type'</span><span class="p">,</span>
  <span class="nv">`data_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'data_id'</span><span class="p">,</span>
  <span class="nv">`group_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'group_id'</span><span class="p">,</span>
  <span class="nv">`tenant_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'tenant_id'</span><span class="p">,</span>
  <span class="nv">`nid`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`nid`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`uk_configtagrelation_configidtag`</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">,</span><span class="nv">`tag_name`</span><span class="p">,</span><span class="nv">`tag_type`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="nv">`idx_tenant_id`</span> <span class="p">(</span><span class="nv">`tenant_id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">'config_tag_relation'</span><span class="p">;</span>

<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = group_capacity   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`group_capacity`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">'主键ID'</span><span class="p">,</span>
  <span class="nv">`group_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'Group ID，空字符表示整个集群'</span><span class="p">,</span>
  <span class="nv">`quota`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'配额，0表示使用默认值'</span><span class="p">,</span>
  <span class="nv">`usage`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'使用量'</span><span class="p">,</span>
  <span class="nv">`max_size`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'单个配置大小上限，单位为字节，0表示使用默认值'</span><span class="p">,</span>
  <span class="nv">`max_aggr_count`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'聚合子配置最大个数，，0表示使用默认值'</span><span class="p">,</span>
  <span class="nv">`max_aggr_size`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值'</span><span class="p">,</span>
  <span class="nv">`max_history_count`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'最大变更历史数量'</span><span class="p">,</span>
  <span class="nv">`gmt_create`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">'创建时间'</span><span class="p">,</span>
  <span class="nv">`gmt_modified`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">'修改时间'</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`uk_group_id`</span> <span class="p">(</span><span class="nv">`group_id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">'集群、各Group容量信息表'</span><span class="p">;</span>

<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = his_config_info   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`his_config_info`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">64</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`nid`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span><span class="p">,</span>
  <span class="nv">`data_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`group_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`app_name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'app_name'</span><span class="p">,</span>
  <span class="nv">`content`</span> <span class="nb">longtext</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`md5`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`gmt_create`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
  <span class="nv">`gmt_modified`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span><span class="p">,</span>
  <span class="nv">`src_user`</span> <span class="nb">text</span><span class="p">,</span>
  <span class="nv">`src_ip`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`op_type`</span> <span class="nb">char</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span><span class="p">,</span>
  <span class="nv">`tenant_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'租户字段'</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`nid`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="nv">`idx_gmt_create`</span> <span class="p">(</span><span class="nv">`gmt_create`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="nv">`idx_gmt_modified`</span> <span class="p">(</span><span class="nv">`gmt_modified`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="nv">`idx_did`</span> <span class="p">(</span><span class="nv">`data_id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">'多租户改造'</span><span class="p">;</span>


<span class="cm">/******************************************/</span>
<span class="cm">/*   数据库全名 = nacos_config   */</span>
<span class="cm">/*   表名称 = tenant_capacity   */</span>
<span class="cm">/******************************************/</span>
<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`tenant_capacity`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">'主键ID'</span><span class="p">,</span>
  <span class="nv">`tenant_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'Tenant ID'</span><span class="p">,</span>
  <span class="nv">`quota`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'配额，0表示使用默认值'</span><span class="p">,</span>
  <span class="nv">`usage`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'使用量'</span><span class="p">,</span>
  <span class="nv">`max_size`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'单个配置大小上限，单位为字节，0表示使用默认值'</span><span class="p">,</span>
  <span class="nv">`max_aggr_count`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'聚合子配置最大个数'</span><span class="p">,</span>
  <span class="nv">`max_aggr_size`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'单个聚合数据的子配置大小上限，单位为字节，0表示使用默认值'</span><span class="p">,</span>
  <span class="nv">`max_history_count`</span> <span class="nb">int</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="nb">unsigned</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="s1">'0'</span> <span class="k">COMMENT</span> <span class="s1">'最大变更历史数量'</span><span class="p">,</span>
  <span class="nv">`gmt_create`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">'创建时间'</span><span class="p">,</span>
  <span class="nv">`gmt_modified`</span> <span class="nb">datetime</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">DEFAULT</span> <span class="k">CURRENT_TIMESTAMP</span> <span class="k">COMMENT</span> <span class="s1">'修改时间'</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`uk_tenant_id`</span> <span class="p">(</span><span class="nv">`tenant_id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">'租户容量信息表'</span><span class="p">;</span>


<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`tenant_info`</span> <span class="p">(</span>
  <span class="nv">`id`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="n">AUTO_INCREMENT</span> <span class="k">COMMENT</span> <span class="s1">'id'</span><span class="p">,</span>
  <span class="nv">`kp`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'kp'</span><span class="p">,</span>
  <span class="nv">`tenant_id`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">default</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'tenant_id'</span><span class="p">,</span>
  <span class="nv">`tenant_name`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span> <span class="k">default</span> <span class="s1">''</span> <span class="k">COMMENT</span> <span class="s1">'tenant_name'</span><span class="p">,</span>
  <span class="nv">`tenant_desc`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">256</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'tenant_desc'</span><span class="p">,</span>
  <span class="nv">`create_source`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">32</span><span class="p">)</span> <span class="k">DEFAULT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'create_source'</span><span class="p">,</span>
  <span class="nv">`gmt_create`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'创建时间'</span><span class="p">,</span>
  <span class="nv">`gmt_modified`</span> <span class="nb">bigint</span><span class="p">(</span><span class="mi">20</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">COMMENT</span> <span class="s1">'修改时间'</span><span class="p">,</span>
  <span class="k">PRIMARY</span> <span class="k">KEY</span> <span class="p">(</span><span class="nv">`id`</span><span class="p">),</span>
  <span class="k">UNIQUE</span> <span class="k">KEY</span> <span class="nv">`uk_tenant_info_kptenantid`</span> <span class="p">(</span><span class="nv">`kp`</span><span class="p">,</span><span class="nv">`tenant_id`</span><span class="p">),</span>
  <span class="k">KEY</span> <span class="nv">`idx_tenant_id`</span> <span class="p">(</span><span class="nv">`tenant_id`</span><span class="p">)</span>
<span class="p">)</span> <span class="n">ENGINE</span><span class="o">=</span><span class="n">InnoDB</span> <span class="k">DEFAULT</span> <span class="n">CHARSET</span><span class="o">=</span><span class="n">utf8</span> <span class="k">COLLATE</span><span class="o">=</span><span class="n">utf8_bin</span> <span class="k">COMMENT</span><span class="o">=</span><span class="s1">'tenant_info'</span><span class="p">;</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`users`</span> <span class="p">(</span>
	<span class="nv">`username`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
	<span class="nv">`password`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">500</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="nv">`enabled`</span> <span class="nb">boolean</span> <span class="k">NOT</span> <span class="k">NULL</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`roles`</span> <span class="p">(</span>
	<span class="nv">`username`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="nv">`role`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
	<span class="k">UNIQUE</span> <span class="k">INDEX</span> <span class="nv">`idx_user_role`</span> <span class="p">(</span><span class="nv">`username`</span> <span class="k">ASC</span><span class="p">,</span> <span class="nv">`role`</span> <span class="k">ASC</span><span class="p">)</span> <span class="k">USING</span> <span class="n">BTREE</span>
<span class="p">);</span>

<span class="k">CREATE</span> <span class="k">TABLE</span> <span class="nv">`permissions`</span> <span class="p">(</span>
    <span class="nv">`role`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">50</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`resource`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">255</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="nv">`action`</span> <span class="nb">varchar</span><span class="p">(</span><span class="mi">8</span><span class="p">)</span> <span class="k">NOT</span> <span class="k">NULL</span><span class="p">,</span>
    <span class="k">UNIQUE</span> <span class="k">INDEX</span> <span class="nv">`uk_role_permission`</span> <span class="p">(</span><span class="nv">`role`</span><span class="p">,</span><span class="nv">`resource`</span><span class="p">,</span><span class="nv">`action`</span><span class="p">)</span> <span class="k">USING</span> <span class="n">BTREE</span>
<span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">users</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">,</span> <span class="n">enabled</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'nacos'</span><span class="p">,</span> <span class="s1">'$2a$10$EuWPZHzz32dJN7jexM34MOeYirDdFAZm2kuWj7VEOJhhZkDrxfvUu'</span><span class="p">,</span> <span class="k">TRUE</span><span class="p">);</span>

<span class="k">INSERT</span> <span class="k">INTO</span> <span class="n">roles</span> <span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="k">role</span><span class="p">)</span> <span class="k">VALUES</span> <span class="p">(</span><span class="s1">'nacos'</span><span class="p">,</span> <span class="s1">'ROLE_ADMIN'</span><span class="p">);</span>
</pre></table></code></div></div><h2 id="22下载nacos"><span class="mr-2">2.2.下载nacos</span><a href="#22下载nacos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>nacos在GitHub上有下载地址：https://github.com/alibaba/nacos/tags，可以选择任意版本下载。</p><p>本例中才用1.4.1版本：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20210409212119411.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20210409212119411.png" alt="image-20210409212119411" class="lazyload" data-proofer-ignore></a></p><h2 id="23配置nacos"><span class="mr-2">2.3.配置Nacos</span><a href="#23配置nacos" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>将这个包解压到任意非中文目录下，如图：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20210402161843337.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20210402161843337.png" alt="image-20210402161843337" class="lazyload" data-proofer-ignore></a></p><p>目录说明：</p><ul><li>bin：启动脚本<li>conf：配置文件</ul><p>进入nacos的conf目录，修改配置文件cluster.conf.example，重命名为cluster.conf：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20210409212459292.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20210409212459292.png" alt="image-20210409212459292" class="lazyload" data-proofer-ignore></a></p><p>然后添加内容：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>127.0.0.1:8845
127.0.0.1.8846
127.0.0.1.8847
</pre></table></code></div></div><p>然后修改application.properties文件，添加数据库配置</p><div class="language-properties highlighter-rouge"><div class="code-header"> <span data-label-text="Properties"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="py">spring.datasource.platform</span><span class="p">=</span><span class="s">mysql</span>

<span class="py">db.num</span><span class="p">=</span><span class="s">1</span>

<span class="py">db.url.0</span><span class="p">=</span><span class="s">jdbc:mysql://127.0.0.1:3306/nacos?characterEncoding=utf8&amp;connectTimeout=1000&amp;socketTimeout=3000&amp;autoReconnect=true&amp;useUnicode=true&amp;useSSL=false&amp;serverTimezone=UTC</span>
<span class="py">db.user.0</span><span class="p">=</span><span class="s">root</span>
<span class="py">db.password.0</span><span class="p">=</span><span class="s">123</span>
</pre></table></code></div></div><h2 id="24启动"><span class="mr-2">2.4.启动</span><a href="#24启动" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>将nacos文件夹复制三份，分别命名为：nacos1、nacos2、nacos3</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20210409213335538.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20210409213335538.png" alt="image-20210409213335538" class="lazyload" data-proofer-ignore></a></p><p>然后分别修改三个文件夹中的application.properties，</p><p>nacos1:</p><div class="language-properties highlighter-rouge"><div class="code-header"> <span data-label-text="Properties"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="py">server.port</span><span class="p">=</span><span class="s">8845</span>
</pre></table></code></div></div><p>nacos2:</p><div class="language-properties highlighter-rouge"><div class="code-header"> <span data-label-text="Properties"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="py">server.port</span><span class="p">=</span><span class="s">8846</span>
</pre></table></code></div></div><p>nacos3:</p><div class="language-properties highlighter-rouge"><div class="code-header"> <span data-label-text="Properties"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="py">server.port</span><span class="p">=</span><span class="s">8847</span>
</pre></table></code></div></div><p>然后分别启动三个nacos节点：</p><div class="language-plaintext highlighter-rouge"><div class="code-header"> <span data-label-text="Plaintext"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>startup.cmd
</pre></table></code></div></div><h2 id="25nginx反向代理"><span class="mr-2">2.5.nginx反向代理</span><a href="#25nginx反向代理" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>找到课前资料提供的nginx安装包：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20210410103253355.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20210410103253355.png" alt="image-20210410103253355" class="lazyload" data-proofer-ignore></a></p><p>解压到任意非中文目录下：</p><p><a href="/assets/blog_res/2024-03-07-微服务.assets/image-20210410103322874.png" class="popup img-link "><img data-src="/assets/blog_res/2024-03-07-微服务.assets/image-20210410103322874.png" alt="image-20210410103322874" class="lazyload" data-proofer-ignore></a></p><p>修改conf/nginx.conf文件，配置如下：</p><div class="language-nginx highlighter-rouge"><div class="code-header"> <span data-label-text="Nginx"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">upstream</span> <span class="s">nacos-cluster</span> <span class="p">{</span>
    <span class="kn">server</span> <span class="nf">127.0.0.1</span><span class="p">:</span><span class="mi">8845</span><span class="p">;</span>
	<span class="kn">server</span> <span class="nf">127.0.0.1</span><span class="p">:</span><span class="mi">8846</span><span class="p">;</span>
	<span class="kn">server</span> <span class="nf">127.0.0.1</span><span class="p">:</span><span class="mi">8847</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">server</span> <span class="p">{</span>
    <span class="kn">listen</span>       <span class="mi">80</span><span class="p">;</span>
    <span class="kn">server_name</span>  <span class="s">localhost</span><span class="p">;</span>

    <span class="kn">location</span> <span class="n">/nacos</span> <span class="p">{</span>
        <span class="kn">proxy_pass</span> <span class="s">http://nacos-cluster</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>而后在浏览器访问：http://localhost/nacos即可。</p><p>代码中application.yml文件配置如下：</p><div class="language-yaml highlighter-rouge"><div class="code-header"> <span data-label-text="YAML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="已复制！"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="na">spring</span><span class="pi">:</span>
  <span class="na">cloud</span><span class="pi">:</span>
    <span class="na">nacos</span><span class="pi">:</span>
      <span class="na">server-addr</span><span class="pi">:</span> <span class="s">localhost:80</span> <span class="c1"># Nacos地址</span>
</pre></table></code></div></div><h2 id="26优化"><span class="mr-2">2.6.优化</span><a href="#26优化" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><ul><li><p>实际部署时，需要给做反向代理的nginx服务器设置一个域名，这样后续如果有服务器迁移nacos的客户端也无需更改配置.</p><li><p>Nacos的各个节点应该部署到多个不同服务器，做好容灾和隔离</p></ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/'>微服务</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/%E5%AD%A6%E4%B9%A0/" class="post-tag no-text-decoration" >学习</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> 本文由作者按照 <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> 进行授权</div><div class="share-wrapper"> <span class="share-label text-muted mr-1">分享</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%80Nacos%20-%20%E5%B0%8F%E7%89%9B&url=%2Fposts%2F%25E5%25BE%25AE%25E6%259C%258D%25E5%258A%25A1%25E4%25B8%2580%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%80Nacos%20-%20%E5%B0%8F%E7%89%9B&u=%2Fposts%2F%25E5%25BE%25AE%25E6%259C%258D%25E5%258A%25A1%25E4%25B8%2580%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://t.me/share/url?url=%2Fposts%2F%25E5%25BE%25AE%25E6%259C%258D%25E5%258A%25A1%25E4%25B8%2580%2F&text=%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%80Nacos%20-%20%E5%B0%8F%E7%89%9B" data-toggle="tooltip" data-placement="top" title="Telegram" target="_blank" rel="noopener" aria-label="Telegram"> <i class="fa-fw fab fa-telegram"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="分享链接" data-title-succeed="链接已复制！"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">最近更新</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/MVCC/">MVCC</a><li><a href="/posts/Redis/">Redis</a><li><a href="/posts/JAVA%E5%9F%BA%E7%A1%80/">JAVA基础</a><li><a href="/posts/%E9%9D%A2%E8%AF%95/">面试题总结</a><li><a href="/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%80/">微服务一Nacos</a></ul></div><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E5%AD%A6%E4%B9%A0/">学习</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">文章内容</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>相关文章</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/MySQL/"><div class="card-body"> <em class="small" data-ts="1710124440" data-df="YYYY/MM/DD" > 2024/03/11 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Mysql</h3><div class="text-muted small"><p> 1.存储引擎–视频地址：https://www.bilibili.com/video/BV1Kr4y1i7ru/ 1.存储引擎就是存储数据、建立索引、更新/查询数据等技术的实现方式。存储引擎是基于表的，而不是基于库的，所以存储引擎也可被 称为表类型。 2.存储引擎的特点 事务的四大特性 acid 原子性 隔离性 一致性 持久性 3.索引概述 介绍 索引(index...</p></div></div></a></div><div class="card"> <a href="/posts/JAVA%E5%9F%BA%E7%A1%80/"><div class="card-body"> <em class="small" data-ts="1704162840" data-df="YYYY/MM/DD" > 2024/01/02 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>JAVA基础</h3><div class="text-muted small"><p> 1.IDEA常用快捷键 2.匿名内部类 3.枚举 4.泛型 自定义泛型类 实际实现 泛型 接口 5.接口 接口的好处 这里new的不是接口，而是A的实例，前面指的是定义了一个接口变量，后面指的是用A的实例（对象）去指向改接口变量。简而言之，接口不能实例化对象，但是可以创建一个变量，让他的实现类的实例指向...</p></div></div></a></div><div class="card"> <a href="/posts/git%E5%91%BD%E4%BB%A4%E7%9A%84%E4%BD%BF%E7%94%A8/"><div class="card-body"> <em class="small" data-ts="1704249240" data-df="YYYY/MM/DD" > 2024/01/03 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>git命令的使用</h3><div class="text-muted small"><p> git几种状态 git reset的三种模式 git reset – soft 工作区和暂存区回说某一个版本，不会删除工作区和暂存区的内容 git reset –hard 工作区和暂存区回溯上某个版本，会删除工作区和暂存区的内容 git reset – mixed 工作区和暂存区回溯上某个版本，不会删除工作区的内容，但会删除暂存区的内容 git diff的使用...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/MybatisPlus/" class="btn btn-outline-primary" prompt="上一篇"><p>MyBatisPlus</p></a> <a href="/posts/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%89/" class="btn btn-outline-primary" prompt="下一篇"><p>微服务三-网关</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">热门标签</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/%E5%AD%A6%E4%B9%A0/">学习</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2024 <a href="https://twitter.com/littleWang1">小牛</a>. <span data-toggle="tooltip" data-placement="top" title="除非另有说明，本网站上的博客文章均由作者按照知识共享署名 4.0 国际 (CC BY 4.0) 许可协议进行授权。">保留部分权利。</span></p></div><div class="footer-right"><p class="mb-0">本站由 <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> 生成，采用 <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> 主题。</p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> (function () { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default"); let config = {theme: expectedTheme}; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function () { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Create mermaid tag */ $("pre").has("code.language-mermaid").each(function () { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); })(); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a> <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">搜索结果为空</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/zh.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/unregister.js"></script>
